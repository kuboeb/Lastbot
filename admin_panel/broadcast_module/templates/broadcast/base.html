{% extends "base.html" %}

{% block extra_css %}
<style>
    .broadcast-card {
        transition: all 0.3s ease;
        border: 1px solid #dee2e6;
    }
    .broadcast-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .status-badge {
        font-size: 0.875rem;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
    }
    .status-draft { background-color: #e9ecef; color: #495057; }
    .status-scheduled { background-color: #cfe2ff; color: #084298; }
    .status-sending { background-color: #fff3cd; color: #664d03; }
    .status-sent { background-color: #d1e7dd; color: #0f5132; }
    
    .audience-badge {
        background-color: #f8f9fa;
        color: #495057;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.875rem;
    }
    
    .progress-bar-animated {
        transition: width 0.6s ease;
    }
    
    .emoji-picker {
        position: absolute;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: none;
        z-index: 1000;
        max-width: 300px;
    }
    
    .emoji-picker span {
        font-size: 24px;
        cursor: pointer;
        padding: 5px;
        display: inline-block;
    }
    
    .emoji-picker span:hover {
        background-color: #f8f9fa;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block content %}
{% block broadcast_content %}{% endblock %}
{% endblock %}

{% block extra_js %}
<script>
// Общие функции для модуля рассылок
function showEmojiPicker(event) {
    event.preventDefault();
    const picker = document.getElementById('emojiPicker');
    picker.style.display = picker.style.display === 'block' ? 'none' : 'block';
    picker.style.left = event.pageX + 'px';
    picker.style.top = event.pageY + 'px';
}

function insertEmoji(emoji) {
    const messageField = document.getElementById('message');
    const cursorPos = messageField.selectionStart;
    const textBefore = messageField.value.substring(0, cursorPos);
    const textAfter = messageField.value.substring(cursorPos);
    
    messageField.value = textBefore + emoji + textAfter;
    messageField.focus();
    messageField.selectionStart = messageField.selectionEnd = cursorPos + emoji.length;
    
    document.getElementById('emojiPicker').style.display = 'none';
    updateCharCount();
}

function updateCharCount() {
    const message = document.getElementById('message').value;
    const charCount = message.length;
    const charCountElement = document.getElementById('charCount');
    
    charCountElement.textContent = `${charCount} / 4096`;
    
    if (charCount > 4000) {
        charCountElement.classList.add('text-danger');
    } else if (charCount > 3500) {
        charCountElement.classList.add('text-warning');
        charCountElement.classList.remove('text-danger');
    } else {
        charCountElement.classList.remove('text-danger', 'text-warning');
    }
}

// Закрытие emoji picker при клике вне
document.addEventListener('click', function(event) {
    const picker = document.getElementById('emojiPicker');
    const button = document.querySelector('.emoji-button');
    
    if (picker && !picker.contains(event.target) && !button.contains(event.target)) {
        picker.style.display = 'none';
    }
});
</script>
{% endblock %}
