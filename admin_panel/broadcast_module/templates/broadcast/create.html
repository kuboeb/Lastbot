{% extends "broadcast/base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É{% endblock %}

{% block broadcast_content %}
<div class="container-fluid">
    <div class="mb-4">
        <a href="{{ url_for('broadcast.broadcast_list') }}" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Ä–∞—Å—Å—ã–ª–∫–∞–º
        </a>
        <h1 class="h3 mt-2">–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</h1>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <!-- –¢–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏ -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">–¢–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏</label>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check card p-3">
                                    <input class="form-check-input" type="radio" name="broadcastType" 
                                           id="typeSingle" value="single" checked onchange="toggleBroadcastType()">
                                    <label class="form-check-label" for="typeSingle">
                                        <i class="bi bi-envelope fs-5"></i>
                                        <strong>–†–∞–∑–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</strong>
                                        <p class="text-muted small mb-0">–û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º</p>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check card p-3">
                                    <input class="form-check-input" type="radio" name="broadcastType" 
                                           id="typeScenario" value="scenario" onchange="toggleBroadcastType()">
                                    <label class="form-check-label" for="typeScenario">
                                        <i class="bi bi-diagram-3 fs-5"></i>
                                        <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π</strong>
                                        <p class="text-muted small mb-0">–°–µ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</p>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –í—ã–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è -->
                    <div id="scenarioSelect" class="mb-4" style="display: none;">
                        <label class="form-label fw-bold">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π</label>
                        <select class="form-select" id="scenario">
                            <option value="warming">üî• –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ–≤–∞ (–¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –±–µ–∑ –∑–∞—è–≤–∫–∏)</option>
                            <option value="retention">üìö –£–¥–µ—Ä–∂–∞–Ω–∏–µ (–¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Å –∑–∞—è–≤–∫–æ–π)</option>
                        </select>
                        <div class="mt-2 p-3 bg-light rounded" id="scenarioDescription">
                            <strong>–í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ–≤–∞:</strong> 4 —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∫ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å
                        </div>
                    </div>

                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                    <div class="mb-3">
                        <label for="name" class="form-label fw-bold">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏</label>
                        <input type="text" class="form-control" id="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ" required>
                    </div>

                    <!-- –ê—É–¥–∏—Ç–æ—Ä–∏—è -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">–ê—É–¥–∏—Ç–æ—Ä–∏—è</label>
                        <div class="row g-2">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="audience" 
                                           id="audienceAll" value="all" checked onchange="updateAudiencePreview()">
                                    <label class="form-check-label" for="audienceAll">
                                        –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="audience" 
                                           id="audienceNoApp" value="no_application" onchange="updateAudiencePreview()">
                                    <label class="form-check-label" for="audienceNoApp">
                                        –ë–µ–∑ –∑–∞—è–≤–∫–∏
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="audience" 
                                           id="audienceWithApp" value="with_application" onchange="updateAudiencePreview()">
                                    <label class="form-check-label" for="audienceWithApp">
                                        –° –∑–∞—è–≤–∫–æ–π
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <span class="text-muted">–ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π: </span>
                            <span id="audienceCount" class="fw-bold">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                    </div>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ (–¥–ª—è —Ä–∞–∑–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏) -->
                    <div id="messageBlock" class="mb-4">
                        <label for="message" class="form-label fw-bold">
                            –°–æ–æ–±—â–µ–Ω–∏–µ
                            <button class="btn btn-sm btn-outline-secondary ms-2 emoji-button" onclick="showEmojiPicker(event)">
                                üòä –≠–º–æ–¥–∑–∏
                            </button>
                        </label>
                        <textarea class="form-control" id="message" rows="8" 
                                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..." 
                                  onkeyup="updateCharCount()" required></textarea>
                        <div class="d-flex justify-content-between mt-1">
                            <small class="text-muted">
                                –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {name}
                            </small>
                            <small id="charCount" class="text-muted">0 / 4096</small>
                        </div>
                    </div>

                    <!-- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                    <div id="scheduleBlock" class="mb-4">
                        <label class="form-label fw-bold">–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="schedule" 
                                   id="scheduleNow" value="now" checked>
                            <label class="form-check-label" for="scheduleNow">
                                –°–µ–π—á–∞—Å (—Å —É–º–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ 30-90 —Å–µ–∫ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="schedule" 
                                   id="scheduleLater" value="later">
                            <label class="form-check-label" for="scheduleLater">
                                –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
                            </label>
                        </div>
                        <div id="scheduleDateTime" class="mt-2" style="display: none;">
                            <input type="datetime-local" class="form-control" id="scheduleTime">
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" onclick="createBroadcast()">
                            <i class="bi bi-check-circle"></i> –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="testBroadcast()">
                            <i class="bi bi-send"></i> –¢–µ—Å—Ç —Å–µ–±–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–≤—å—é -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-phone"></i> –ü—Ä–µ–≤—å—é —Å–æ–æ–±—â–µ–Ω–∏—è
                </div>
                <div class="card-body">
                    <div class="border rounded p-3 bg-light" style="min-height: 200px;">
                        <div id="messagePreview" class="text-break">
                            –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...
                        </div>
                    </div>
                </div>
            </div>

            <!-- –®–∞–±–ª–æ–Ω—ã -->
            <div class="card mt-3">
                <div class="card-header">
                    <i class="bi bi-file-text"></i> –®–∞–±–ª–æ–Ω—ã
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-sm btn-outline-primary text-start" 
                                onclick="useTemplate('reminder')">
                            üì¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫—É—Ä—Å–µ
                        </button>
                        <button class="btn btn-sm btn-outline-primary text-start" 
                                onclick="useTemplate('limited')">
                            ‚è∞ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-sm btn-outline-primary text-start" 
                                onclick="useTemplate('success')">
                            ‚≠ê –ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Emoji Picker -->
<div id="emojiPicker" class="emoji-picker">
    <span onclick="insertEmoji('üòÄ')">üòÄ</span>
    <span onclick="insertEmoji('üòä')">üòä</span>
    <span onclick="insertEmoji('üéâ')">üéâ</span>
    <span onclick="insertEmoji('üöÄ')">üöÄ</span>
    <span onclick="insertEmoji('üí∞')">üí∞</span>
    <span onclick="insertEmoji('üìö')">üìö</span>
    <span onclick="insertEmoji('‚úÖ')">‚úÖ</span>
    <span onclick="insertEmoji('üî•')">üî•</span>
    <span onclick="insertEmoji('üíé')">üíé</span>
    <span onclick="insertEmoji('‚≠ê')">‚≠ê</span>
    <span onclick="insertEmoji('üìà')">üìà</span>
    <span onclick="insertEmoji('üéØ')">üéØ</span>
    <span onclick="insertEmoji('üí°')">üí°</span>
    <span onclick="insertEmoji('üéÅ')">üéÅ</span>
    <span onclick="insertEmoji('‚è∞')">‚è∞</span>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
function toggleBroadcastType() {
    const type = document.querySelector('input[name="broadcastType"]:checked').value;
    document.getElementById('scenarioSelect').style.display = type === 'scenario' ? 'block' : 'none';
    document.getElementById('messageBlock').style.display = type === 'single' ? 'block' : 'none';
    document.getElementById('scheduleBlock').style.display = type === 'single' ? 'block' : 'none';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è
document.getElementById('scenario').addEventListener('change', function() {
    const descriptions = {
        'warming': '<strong>–í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–≥—Ä–µ–≤–∞:</strong> 4 —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∫ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å',
        'retention': '<strong>–£–¥–µ—Ä–∂–∞–Ω–∏–µ:</strong> –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 3 –¥–Ω—è —Å –ø–æ–ª–µ–∑–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º'
    };
    document.getElementById('scenarioDescription').innerHTML = descriptions[this.value];
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é —Å–æ–æ–±—â–µ–Ω–∏—è
document.getElementById('message').addEventListener('input', function() {
    let preview = this.value || '–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...';
    preview = preview.replace('{name}', '–ò–≤–∞–Ω');
    document.getElementById('messagePreview').innerHTML = preview.replace(/\n/g, '<br>');
});

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
document.querySelectorAll('input[name="schedule"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.getElementById('scheduleDateTime').style.display = 
            this.value === 'later' ? 'block' : 'none';
    });
});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é –∞—É–¥–∏—Ç–æ—Ä–∏–∏
async function updateAudiencePreview() {
    const audience = document.querySelector('input[name="audience"]:checked').value;
    const countElement = document.getElementById('audienceCount');
    
    try {
        const response = await fetch('/broadcast/preview', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ audience })
        });
        
        const result = await response.json();
        if (result.success) {
            countElement.textContent = result.count + ' —á–µ–ª–æ–≤–µ–∫';
        }
    } catch (error) {
        countElement.textContent = '–æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
function useTemplate(templateName) {
    const templates = {
        'reminder': `üöÄ {name}, –Ω–∞–ø–æ–º–∏–Ω–∞–µ–º –æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –∫—É—Ä—Å–µ –ø–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–µ!

üìö –ß—Ç–æ –≤–∞—Å –∂–¥–µ—Ç:
- 8 –Ω–µ–¥–µ–ª—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
- –õ–∏—á–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏

üí∞ –ù–∞—à–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—Ç 500‚Ç¨ –≤ –º–µ—Å—è—Ü!

–ù–µ —É–ø—É—Å—Ç–∏—Ç–µ —à–∞–Ω—Å –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ—é –∂–∏–∑–Ω—å. –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! üëá`,

        'limited': `‚è∞ {name}, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!

üéÅ –¢–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å:
- –ë–æ–Ω—É—Å–Ω—ã–π –º–æ–¥—É–ª—å –ø–æ DeFi
- –ó–∞–∫—Ä—ã—Ç—ã–π —á–∞—Ç —Å —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏
- –ß–µ–∫-–ª–∏—Å—Ç "–ü–µ—Ä–≤—ã–µ 1000‚Ç¨"

‚ö° –û—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ 5 –º–µ—Å—Ç!

–£—Å–ø–µ–π—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è üëá`,

        'success': `‚≠ê {name}, –∏—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞ –Ω–∞—à–µ–≥–æ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∞!

"–ù–∞—á–∞–ª —Å 500‚Ç¨, —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—å –≤—ã—Ä–æ—Å –¥–æ 3000‚Ç¨. –ö—É—Ä—Å –∏–∑–º–µ–Ω–∏–ª –º–æ—é –∂–∏–∑–Ω—å!" - –ê–ª–µ–∫—Å–∞–Ω–¥—Ä, –ì–µ—Ä–º–∞–Ω–∏—è

üéØ –•–æ—Ç–∏—Ç–µ —Ç–∞–∫–∏–µ –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?

–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å –∏ –Ω–∞—á–Ω–∏—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ –∫—Ä–∏–ø—Ç–µ! üöÄ`
    };
    
    document.getElementById('message').value = templates[templateName];
    document.getElementById('message').dispatchEvent(new Event('input'));
    updateCharCount();
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏
async function createBroadcast() {
    const type = document.querySelector('input[name="broadcastType"]:checked').value;
    const name = document.getElementById('name').value;
    const audience = document.querySelector('input[name="audience"]:checked').value;
    
    if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏');
        return;
    }
    
    let data = {
        type,
        name,
        audience
    };
    
    if (type === 'single') {
        const message = document.getElementById('message').value;
        if (!message) {
            alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è');
            return;
        }
        data.message = message;
        
        const schedule = document.querySelector('input[name="schedule"]:checked').value;
        if (schedule === 'later') {
            data.scheduled_at = document.getElementById('scheduleTime').value;
        }
    } else {
        data.scenario = document.getElementById('scenario').value;
    }
    
    try {
        const response = await fetch('/broadcast/create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        if (result.success) {
            alert('–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!');
            window.location.href = '/broadcast';
        } else {
            alert('–û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ' + error);
    }
}

// –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
async function testBroadcast() {
    const message = document.getElementById('message').value;
    if (!message) {
        alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞');
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
    const data = {
        type: 'single',
        name: '–¢–µ—Å—Ç: ' + new Date().toLocaleString(),
        audience: 'all',
        message: message
    };
    
    try {
        // –°–æ–∑–¥–∞–µ–º —Ä–∞—Å—Å—ã–ª–∫—É
        const createResponse = await fetch('/broadcast/create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const createResult = await createResponse.json();
        if (!createResult.success) {
            alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞: ' + createResult.error);
            return;
        }
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
        const sendResponse = await fetch(`/broadcast/${createResult.broadcast_id}/send`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ test_mode: true })
        });
        
        const sendResult = await sendResponse.json();
        if (sendResult.success) {
            alert('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–∞–º –≤ –±–æ—Ç!');
        } else {
            alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + sendResult.error);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error);
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateAudiencePreview();
</script>
{% endblock %}
